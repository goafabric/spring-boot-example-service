#!/bin/bash
source .values

export COMMAND=$1
export DEPLOYMENT_NAME=callee-service-application

function up() {
    kubectl create configmap ${DEPLOYMENT_NAME}-config-files --from-file=./config -n ${NAMESPACE}
    kubectl apply -f ./templates/ -n ${NAMESPACE}
    kubectl set image deployment ${DEPLOYMENT_NAME} ${DEPLOYMENT_NAME}=${IMAGE_NAME} -n ${NAMESPACE}
}

function down() {
    kubectl delete --ignore-not-found configmap ${DEPLOYMENT_NAME}-config-files -n ${NAMESPACE}
    kubectl delete --ignore-not-found -f ./templates -n ${NAMESPACE}
}

if [ "${COMMAND}" = "up" ]; then
  up
elif [ "${COMMAND}" = "down" ]; then
  down
elif [ "${COMMAND}" = "prune" ]; then
  down
else
  echo Doing nothing !
fi
